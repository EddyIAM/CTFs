# Challenge report for Malware Traffic Analysis 1

- **Challenge Name: Malware Traffic Analysis 1**
- **Date: Done before I started documenting.**
- **URL: <https://cyberdefenders.org/labs/17>**
- **Status:Complete**

***

## Description

The attached PCAP belongs to an Exploitation Kit infection. Analyze it using your favorite tool and answer the challenge questions.

## Analysis

1. What is the IP address of the Windows VM that gets infected?

    **172.16.165.165**

    ```text
    Load up the pcap in Brim and filter for event_type=="alert"
    ```

2. What is the hostname of the Windows VM that gets infected?

    **K34EN6W3N-PC**

    ```text
    Load up the pcap in Brim and filter for _path=="dhcp" 
    ```

3. What is the MAC address of the infected VM?

    **f0:19:af:02:9b:f1**

    ```text
    Load up wireshark, pick any packet with 72.16.165.165 and look at Ethernet info.
    ```

4. What is the IP address of the compromised web site?

    **82.150.140.30**

    ```text
    Filter in Brim for _path=="http" | cut ts, id.orig_h, id.resp_h, id.resp_p, method,host, referrer, uri | uniq -c | sort ts
    Answer shows in id.resp_h.
    ```

5. What is the FQDN of the compromised website?
  
    **ciniholland.nl**

    ```text
    Filter in Brim for _path=="http" | cut ts, id.orig_h, id.resp_h, id.resp_p, method,host, referrer, uri | uniq -c | sort ts
    Answer shows in host.
    ```

6. What is the IP address of the server that delivered the exploit kit and malware?
  
    **37.200.69.143**

    ```text
    Filter in Brim for event_type=="alert"
    ```

7. What is the FQDN that delivered the exploit kit and malware?
  
    **stand.trustandprobaterealty.com**

    ```text
    Filter in Brim for event_type=="alert" to find the attack then _path=="dns" to find the name the IP resolves to.
    ```

8. What is the redirect URL that points to the exploit kit (EK) landing page?
  
    **<http://24corp-shop.com/>**

    ```text
    Filter in Brim for _path=="http" | cut ts, id.orig_h, id.resp_h, id.resp_p, method,host, referrer, uri | uniq -c | sort ts
    Answer shows in referrer.
    ```

9. Other than CVE-2013-2551 IE exploit, another application was targeted by the EK and starts with "J". Provide the full application name.
  
    **Java**

    ```text
    Browse event_type=="alert"
    ```

10. How many times was the payload delivered?

    **3**

    ```text
    event_type=="alert" and  alert.severity==1 and alert.category=="Exploit Kit Activity Detected" | sort alert.signature
    ```

11. No 11?

12. The compromised website has a malicious script with a URL What is this URL?

    **<http://24corp-shop.com/>**

    ```text
    We know the answer because of questyion 8 above.  That said, lets see if we can find the malicious script.
    Unfotunatly unlike some of the previous answers I don't think we can query right down to the answer.   The best I found was to Hunt for event.dataset:http AND destination.ip:"82.150.140.30" which gives us 20 results.

    Once there then use action PCAP on the log.id.uid column to take a look at each result.  

    <pic Flag 12>

13. Extract the two exploit files. What are the MD5 file hashes? (comma-separated )

    **7b3baa7d6bb3720f369219789e38d6ab,1e34fdebbf655cebea78b45e43520ddf**

    ```text
    _path=="files" |  37.200.69.143 in tx_hosts | cut mime_type, md5 - Select the HD5 for the Java and Flash application mimetype.
    ```
